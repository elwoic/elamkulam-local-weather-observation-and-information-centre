<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    :root {
        --aqi-good: #4caf50;
        --aqi-satisfactory: #8bc34a;
        --aqi-moderate: #ffc107;
        --aqi-poor: #ff9800;
        --aqi-very-poor: #f44336;
    }

    /* 1. Fluid Base: background is transparent to avoid the "white board" look */
    body { 
        font-family: 'Segoe UI', Arial, sans-serif; 
        margin: 0; 
        padding: 0; 
        background: transparent; 
        display: flex; 
        justify-content: center; 
        overflow: hidden; 
    }

    /* 2. Responsive Card: No fixed width, no background plate */
    .bulletin-card {
        width: 100%;
        max-width: 700px;
        background: transparent; /* Removed white background as requested */
        padding: 10px;
        text-align: center;
        box-sizing: border-box;
    }

    /* 3. Responsive Text: Using 'vw' (viewport width) or media queries to shrink text */
    .title-area { 
        color: #002b45; 
        font-size: clamp(14px, 4vw, 18px); /* Min 14px, scales with screen, max 18px */
        font-weight: 600; 
        margin-bottom: 10px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        gap: 8px; 
    }

    .status-hero { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; }
    
    .status-dot { 
        width: clamp(30px, 8vw, 40px); 
        height: clamp(30px, 8vw, 40px); 
        border-radius: 50%; 
        background: #ddd; 
    }

    .status-text { 
        font-size: clamp(16px, 5vw, 22px); 
        font-weight: 700; 
        color: #1a1a1a; 
    }

    /* 4. Legend Bar: Buttons shrink and stack automatically */
    .legend-bar { 
        display: flex; 
        flex-wrap: wrap; 
        justify-content: center; 
        gap: 4px; 
        margin-bottom: 10px; 
    }
    .legend-item { 
        padding: 4px 8px; 
        border-radius: 6px; 
        color: white; 
        font-size: clamp(9px, 2.5vw, 11px); 
        font-weight: 600; 
        flex: 1 1 80px; /* Allows buttons to grow/shrink and wrap */
        max-width: 110px;
    }
    .l-good { background: var(--aqi-good); }
    .l-satisfactory { background: var(--aqi-satisfactory); }
    .l-moderate { background: var(--aqi-moderate); }
    .l-poor { background: var(--aqi-poor); }
    .l-very-poor { background: var(--aqi-very-poor); }

    .health-advice { 
        font-size: clamp(11px, 3vw, 14px); 
        color: #333; 
        margin-bottom: 5px; 
        line-height: 1.3; 
    }
    
    .malayalam-text { 
        font-size: clamp(14px, 4.5vw, 18px); 
        color: #002b45; 
        font-weight: bold; 
        margin-bottom: 5px; 
    }

    .more-info-link { font-size: 10px; color: #0056b3; text-decoration: none; display: block; margin-bottom: 10px; }

    /* 5. Grid Layout: Keeps sensors in one row until screen is very small */
    .sensor-footer { 
        display: grid; 
        grid-template-columns: repeat(3, 1fr); 
        border-top: 1px solid rgba(0,0,0,0.1); 
        padding-top: 10px;
        margin-top: 5px;
        gap: 5px;
    }
    .sensor-label { font-size: clamp(8px, 2vw, 10px); color: #888; text-transform: uppercase; }
    .sensor-val { font-size: clamp(11px, 3vw, 14px); font-weight: 600; color: #444; }

    .attribution { 
        font-size: 9px; 
        color: #aaa; 
        margin-top: 10px; 
        border-top: 1px dotted #ddd; 
        padding-top: 5px; 
    }
</style>
</head>
<body>

<div class="bulletin-card">
    <div class="title-area">
        <img src="https://www.gstatic.com/images/icons/material/system_gm/1x/cloud_white_24dp.png" style="filter: invert(1); width:20px;" alt="">
        Air Quality Index (AQI)
    </div>

    <div class="status-hero">
        <div id="statusDot" class="status-dot"></div>
        <div id="statusText" class="status-text">AQI --</div>
    </div>

    <div class="legend-bar">
        <div class="legend-item l-good">0‚Äì50 Good</div>
        <div class="legend-item l-satisfactory">51‚Äì100 Satisfactory</div>
        <div class="legend-item l-moderate">101‚Äì200 Moderate</div>
        <div class="legend-item l-poor">201‚Äì300 Poor</div>
        <div class="legend-item l-very-poor">301‚Äì500 Very Poor</div>
    </div>

    <div id="healthAdvice" class="health-advice">Loading air quality data...</div>
    <div class="malayalam-text">‡¥á‡¥®‡µç‡¥®‡¥§‡µç‡¥§‡µÜ ‡¥∂‡µÅ‡¥¶‡µç‡¥ß‡¥µ‡¥æ‡¥Ø‡µÅ, ‡¥®‡¥æ‡¥≥‡µÜ‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥Ü‡¥∞‡µã‡¥ó‡µç‡¥Ø‡¥Ç.</div>
    <a href="https://www.airgradient.com" target="_blank" class="more-info-link">AQI ‡¥é‡¥®‡µç‡¥§‡µç ‡¥é‡¥®‡µç‡¥®‡µç ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥Ö‡¥±‡¥ø‡¥Ø‡¥æ‡¥Ç.</a>

    <div class="sensor-footer">
        <div class="sensor-item"><div class="sensor-label">CO‚ÇÇ (ppm)</div><div class="sensor-val" id="co2">--</div></div>
        <div class="sensor-item"><div class="sensor-label">TVOC Index</div><div class="sensor-val" id="tvoc">--</div></div>
        <div class="sensor-item"><div class="sensor-label">NOx Index</div><div class="sensor-val" id="nox">--</div></div>
    </div>

    <div class="attribution">
        Source: ELWOIC Station | Last Updated:<span id="time">--</span> | 
        Powered by <a href="https://www.airgradient.com" target="_blank">AirGradient</a>
    </div>
</div>

<script>
const API_URL = "https://curly-sound-5bea.elwoicelamkulam.workers.dev/api";

function pm25ToAQI(pm) {
    const bp = [
        { cL: 0, cH: 12, aL: 0, aH: 50 },
        { cL: 12.1, cH: 35.4, aL: 51, aH: 100 },
        { cL: 35.5, cH: 55.4, aL: 101, aH: 150 },
        { cL: 55.5, cH: 150.4, aL: 151, aH: 200 },
        { cL: 150.5, cH: 250.4, aL: 201, aH: 300 },
        { cL: 250.5, cH: 500, aL: 301, aH: 500 }
    ];
    for (const r of bp) {
        if (pm >= r.cL && pm <= r.cH) return Math.round(((r.aH - r.aL)/(r.cH - r.cL))*(pm - r.cL) + r.aL);
    }
    return Math.round(pm);
}

function getStatus(aqi) {
    if (aqi <= 50) return { text: "Good", color: "#4caf50", emoji: "üòÄ", advice: "Air quality is good. Ideal for outdoor activities." };
    if (aqi <= 100) return { text: "Satisfactory", color: "#8bc34a", emoji: "üôÇ", advice: "Air quality is satisfactory. Acceptable for most." };
    if (aqi <= 200) return { text: "Moderate", color: "#ffc107", emoji: "üòê", advice: "Moderate pollution. Sensitive groups should limit effort." };
    if (aqi <= 300) return { text: "Poor", color: "#ff9800", emoji: "üò∑", advice: "Poor air quality. Avoid prolonged outdoor exposure." };
    return { text: "Very Poor", color: "#f44336", emoji: "‚òπÔ∏è", advice: "Health Alert: Everyone should avoid outdoor activities." };
}

async function updateDashboard() {
    try {
        const res = await fetch(API_URL);
        let data = await res.json();
        if (Array.isArray(data)) data = data[0];

        const pm = parseFloat(data.pm02_corrected);
        const aqi = pm25ToAQI(pm);
        const st = getStatus(aqi);

        document.getElementById("statusDot").style.background = st.color;
        document.getElementById("statusText").innerText = `AQI ${aqi} ‚Äî ${st.text} ${st.emoji}`;
        document.getElementById("healthAdvice").innerText = `${st.advice} (PM2.5: ${pm} ¬µg/m¬≥)`;
        
        document.getElementById("co2").innerText = data.rco2_corrected;
        document.getElementById("tvoc").innerText = data.tvocIndex || "--";
        document.getElementById("nox").innerText = data.noxIndex || "--";
        document.getElementById("time").innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

    } catch (e) {
        document.getElementById("statusText").innerText = "Offline";
    }
}

updateDashboard();
setInterval(updateDashboard, 300000);
</script>

</body>
</html>
