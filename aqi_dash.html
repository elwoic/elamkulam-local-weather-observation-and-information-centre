<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ELWOIC Air Quality Bulletin</title>

<style>  
body{
    margin:0;
    background:#e6e6e6;
    font-family:"Segoe UI", Arial, sans-serif;
}

.page{
    width:850px;
    margin:40px auto;
    background:white;
    box-shadow:0 0 20px rgba(0,0,0,0.15);
}

.header{
    background:#002b45;
    color:white;
    padding:25px;
    text-align:center;
}

.header h1{
    margin:0;
    font-size:24px;
    letter-spacing:1px;
}

.sub{
    font-size:13px;
    margin-top:5px;
    opacity:0.9;
}

.aqi-section{
    text-align:center;
    padding:40px 20px;
}

.aqi-value{
    font-size:85px;
    font-weight:bold;
}

.aqi-status{
    font-size:20px;
    margin-top:10px;
    font-weight:500;
}

.divider{
    height:3px;
    background:#002b45;
}

.section{
    padding:30px 50px;
}

table{
    width:100%;
    border-collapse:collapse;
}

td{
    padding:12px;
    border-bottom:1px solid #ddd;
    font-size:15px;
}

.footer{
    padding:20px;
    text-align:center;
    font-size:13px;
    color:#555;
}
</style>
</head>

<body>

<div class="page">

<div class="header">
<h1>ELWOIC AIR QUALITY BULLETIN</h1>
<div class="sub">Elamkulam Monitoring Station</div>
</div>

<div class="aqi-section">
<div class="aqi-value" id="aqiValue">--</div>
<div class="aqi-status" id="aqiStatus">Loading...</div>
</div>

<div class="divider"></div>

<div class="section">
<table>
<tr><td>PM2.5 (Âµg/mÂ³)</td><td id="pm25">--</td></tr>
<tr><td>Temperature (Â°C)</td><td id="temp">--</td></tr>
<tr><td>Humidity (%)</td><td id="humidity">--</td></tr>
<tr><td>COâ‚‚ (ppm)</td><td id="co2">--</td></tr>
<tr><td>TVOC Index</td><td id="tvoc">--</td></tr>
<tr><td>NOx Index</td><td id="nox">--</td></tr>
</table>
</div>

<div class="footer">
Last Updated: <span id="timestamp">--</span>
</div>

</div>

<script>

// ðŸ” Your Cloudflare Worker URL goes here
const API_URL = "YOUR_WORKER_URL";

function calculateAQI(pm){
    const bp=[
        {pmLow:0,pmHigh:12,aqiLow:0,aqiHigh:50},
        {pmLow:12.1,pmHigh:35.4,aqiLow:51,aqiHigh:100},
        {pmLow:35.5,pmHigh:55.4,aqiLow:101,aqiHigh:150},
        {pmLow:55.5,pmHigh:150.4,aqiLow:151,aqiHigh:200},
        {pmLow:150.5,pmHigh:250.4,aqiLow:201,aqiHigh:300}
    ];

    for(let b of bp){
        if(pm>=b.pmLow && pm<=b.pmHigh){
            return Math.round(
                ((b.aqiHigh-b.aqiLow)/(b.pmHigh-b.pmLow))*(pm-b.pmLow)+b.aqiLow
            );
        }
    }
    return 0;
}

function getStatus(aqi){
    if(aqi<=50) return "Good";
    if(aqi<=100) return "Moderate";
    if(aqi<=150) return "Unhealthy for Sensitive Groups";
    if(aqi<=200) return "Unhealthy";
    return "Very Unhealthy";
}

function getAQIColor(aqi){
    if(aqi<=50) return "#009966";
    if(aqi<=100) return "#ffde33";
    if(aqi<=150) return "#ff9933";
    if(aqi<=200) return "#cc0033";
    return "#660099";
}

async function fetchData(){
    try{
        const res = await fetch(API_URL);
        const data = await res.json();

        const pm = parseFloat(data.pm02_corrected);
        const aqi = calculateAQI(pm);

        document.getElementById("aqiValue").innerText = aqi;
        document.getElementById("aqiStatus").innerText = getStatus(aqi);
        document.getElementById("aqiValue").style.color = getAQIColor(aqi);

        document.getElementById("pm25").innerText = pm;
        document.getElementById("temp").innerText = data.atmp_corrected;
        document.getElementById("humidity").innerText = data.rhum_corrected;
        document.getElementById("co2").innerText = data.rco2_corrected;
        document.getElementById("tvoc").innerText = data.tvocIndex;
        document.getElementById("nox").innerText = data.noxIndex;
        document.getElementById("timestamp").innerText =
            new Date(data.timestamp).toLocaleString();

    }catch(error){
        document.getElementById("aqiStatus").innerText = "Unable to fetch data";
        console.log(error);
    }
}

fetchData();
setInterval(fetchData, 60000);

</script>

</body>
</html>
