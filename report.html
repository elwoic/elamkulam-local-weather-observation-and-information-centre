<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Submit Weather Report | ELWOIC</title>

<style>
/* --- ORIGINAL CSS RESTORED --- */
body {
  font-family: Arial, sans-serif;
  background: #f4faff;
  margin: 0;
  padding: 0;
}

/* Header */
.topbar {
  background: #00457C;
  padding: 15px;
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}
.topbar h1 {
  font-size: 1.5rem;
  margin: 0;
}
.topbar a {
  background: white;
  color: #00457C;
  padding: 8px 14px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.2s;
}
.topbar a:hover {
  background: #cfe6ff;
}

/* Report Form Section */
.report-box {
  margin: 25px auto;
  padding: 25px;
  max-width: 720px;
  background: #eaf5ff;
  border-radius: 10px;
  border-left: 6px solid #0073e6;
  box-shadow: 0 0 6px rgba(0,0,0,0.18);
}

.report-title {
  font-size: 1.6rem;
  margin-bottom: 12px;
  color: #00315c;
  border-bottom: 3px solid #0073e6;
  display: inline-block;
  padding-bottom: 4px;
}

.report-box label {
  display: block;
  margin-top: 13px;
  font-weight: 600;
  color: #00315c;
}

.report-box input,
.report-box textarea,
.report-box select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border: 1px solid #80b6db;
  border-radius: 6px;
  font-size: 1rem;
}

.report-box textarea {
  height: 130px;
  resize: vertical;
}

.report-box button[type="submit"] {
  margin-top: 20px;
  width: 100%;
  background: #0073e6;
  color: white;
  border: none;
  padding: 13px;
  font-size: 1rem;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.25s;
}
.report-box button[type="submit"]:hover {
  background: #005bb7;
}

/* Success Message */
#form-success {
  display: none;
  color: green;
  font-weight: bold;
  margin-top: 15px;
  text-align: center;
  font-size: 1.1rem;
}

/* Responsive tweaks */
@media(max-width: 480px) {
  .topbar {
    flex-direction: column;
    text-align: center;
  }
  .topbar a {
    margin-top: 10px;
  }
}
/* --- END OF ORIGINAL CSS --- */

/* --- NEW CSS for Admin Panel --- */
.admin-toggle {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  cursor: pointer;
  margin-top: 25px;
  color: #00457C;
  font-size: 0.9rem;
  font-weight: 600;
  padding-bottom: 10px; /* Space above the panel */
}
.admin-toggle span {
  margin-left: 5px;
  transition: transform 0.3s;
}
.admin-toggle.open span {
  transform: rotate(180deg);
}
.admin-panel {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s ease-out;
  padding: 0 10px;
  background: #ffffff;
  border-radius: 6px;
  margin-top: 5px;
  border: 1px solid #ddd;
}
.admin-panel.active {
  max-height: 200px; /* Allows the panel to slide down */
  padding: 15px 10px;
}
.admin-panel p {
  margin-top: 0;
  color: #00315c;
  font-weight: bold;
}
.admin-panel input[type="password"] {
  width: calc(100% - 22px);
  margin-bottom: 10px;
}
.admin-panel button {
  background: #dc3545; /* Admin button style */
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
  transition: 0.2s;
}
.admin-panel button:hover {
  background: #c82333;
}
#admin-error {
  color: #dc3545;
  font-size: 0.9rem;
  margin-top: 5px;
  display: none;
}
</style>
</head>

<body>

<div class="topbar">
  <h1>Submit Weather Report</h1>
  <a href="index.html">← Back to Home</a>
</div>

<section class="report-box">
  <h2 class="report-title">Share Your Weather Observation</h2>
  <p style="margin-bottom:15px; color:#00315c;">
    Help ELWOIC improve community weather awareness by reporting what you observe outside.
  </p>

  <form id="weather-report-form">

    <label>Your Name (optional)</label>
    <input type="text" name="name" placeholder="Enter your name (optional)">

    <label>Location / Place *</label>
    <input type="text" name="location" placeholder="Example: Elamkulam North, Valuthur, etc." required>

    <label>Report Type *</label>
    <select name="report_type" required>
      <option value="">--Select Type--</option>
      <option>Rainfall</option>
      <option>Flood / Water Level</option>
      <option>Storm / Wind</option>
      <option>Lightning</option>
      <option>Road Block / Tree Fall</option>
      <option>General Information</option>
      <option>Other</option>
    </select>

    <label>Weather Observation *</label>
    <textarea name="observation" placeholder="Describe the weather activity you observed" required></textarea>

    <label>Time of Event (optional)</label>
    <input type="text" name="time" placeholder="Eg: 7:45 PM, 2 hours ago, etc.">

    <label>Attach Weather Photo (optional)</label>
    <input type="file" name="photo" id="photo-file" accept="image/*">

    <label>Your Email (optional)</label>
    <input type="email" name="email" placeholder="If you want a response">

    <button type="submit">Submit Weather Report</button>
  </form>

  <p id="form-success">✔ Thank you! Your report has been submitted successfully.</p>

  <hr style="margin-top: 30px; border: 0; border-top: 1px solid #ccc;">

  <div class="admin-toggle" id="admin-toggle">
    Admin Only <span id="toggle-icon">▼</span>
  </div>

  <div class="admin-panel" id="admin-panel">
    <p>Enter Admin Password to View Reports</p>
    <input type="password" id="admin-password" placeholder="Password">
    <button id="admin-login-button">Login</button>
    <p id="admin-error">Invalid Password. Try again.</p>
  </div>

</section>

<script type="module">
  // 1. Import necessary Firebase functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
  import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

  // 2. Your Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyASblrFKqSUK6heHly2Bh95EJ_Gqmx0XVQ",
    authDomain: "report-5d8c0.firebaseapp.com",
    databaseURL: "https://report-5d8c0-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "report-5d8c0",
    storageBucket: "report-5d8c0.firebasestorage.app",
    messagingSenderId: "831456060916",
    appId: "1:831456060916:web:1e06b9d3897dd9637305a1",
    measurementId: "G-5MGMM1DYDM"
  };

  // 3. Initialize Firebase and Services
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const storage = getStorage(app);

  const form = document.getElementById('weather-report-form');
  const successMessage = document.getElementById('form-success');
  const photoInput = document.getElementById('photo-file');
  const submitButton = form.querySelector('button[type="submit"]');

  // --- 4. Weather Report Submission Logic ---
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    submitButton.disabled = true;
    submitButton.textContent = 'Submitting...';
    successMessage.style.display = 'none'; // Hide success message on new submit

    try {
      const formData = new FormData(form);
      const file = photoInput.files[0];
      let photoUrl = 'N/A';

      if (file) {
        // Upload photo to Firebase Storage
        const fileName = `${Date.now()}_${file.name}`;
        const imageRef = storageRef(storage, `weather_photos/${fileName}`);
        const snapshot = await uploadBytes(imageRef, file);
        photoUrl = await getDownloadURL(snapshot.ref);
      }

      const reportData = {
        name: formData.get('name') || 'Anonymous',
        location: formData.get('location'),
        report_type: formData.get('report_type'),
        observation: formData.get('observation'),
        time: formData.get('time') || 'N/A',
        email: formData.get('email') || 'N/A',
        timestamp: serverTimestamp(),
        photo_url: photoUrl
      };

      // Save report data to Firebase Realtime Database
      await push(ref(database, 'weather_reports'), reportData);

      // Success feedback
      form.reset();
      submitButton.textContent = 'Report Submitted!';
      successMessage.style.display = 'block';
      setTimeout(() => {
        submitButton.textContent = 'Submit Weather Report';
        successMessage.style.display = 'none';
      }, 5000);

    } catch (error) {
      console.error("Error submitting report:", error);
      alert("An error occurred while submitting the report. Please try again.");
    } finally {
      submitButton.disabled = false;
    }
  });


  // --- 5. Admin Panel Logic ---
  const adminToggle = document.getElementById('admin-toggle');
  const adminPanel = document.getElementById('admin-panel');
  const adminLoginButton = document.getElementById('admin-login-button');
  const adminPasswordInput = document.getElementById('admin-password');
  const adminError = document.getElementById('admin-error');

  // Toggle Admin Panel visibility
  adminToggle.addEventListener('click', () => {
    adminPanel.classList.toggle('active');
    adminToggle.classList.toggle('open');
    adminPasswordInput.value = '';
    adminError.style.display = 'none';
  });

  // Admin Login Button Logic
  adminLoginButton.addEventListener('click', () => {
    const password = adminPasswordInput.value.trim();
    const validPasswords = ["04933", "elwoic811", "elwoic822"];
      
    if (validPasswords.includes(password)) {
      // Successful login - Redirect to reports page
      // Ensure 'admin_reports.html' exists for this to work
      window.location.href = 'admin_reports.html';
    } else {
      // Failed login
      adminError.style.display = 'block';
      adminPasswordInput.value = '';
    }
  });
</script>

</body>
</html>
